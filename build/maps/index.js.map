{"version":3,"sources":["index.js"],"names":["getBehaviorBar","type","val","transTree","find","findIndex","merge","bars","pulldown","filter","loading","over","trigger","_getGroups","data","nsons","dataAry","o","jj","parent","idf","indexcode","push","LOADING","son","ii","opts","idrecode","indexOf","state","concat","curState","findParents","_parentIndex","item","myParents","index","content","p","Tree","Actions","this","TRIGGER","ostate","groups","query","target","sons","tree","dft","props","treeX","Aotoo","getGroups","theme","autoinject","App","getParents","pure","list","isArray","React","createElement","className","_classCallCheck","_this","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","call","preRender","header","footer","list_part","listClass","itemClass","itemMethod","Component","UPDATE","arguments","length","undefined","oriData","unshift","splice","APPEND","LOADED","PREPEND","DELETE"],"mappings":"wnBAkBA,SAASA,eAAeC,EAAMC,GAC5B,OAhBAC,GACAC,IAgBO,WAfPC,GAAAA,EACAC,MAgB2B,kBAhB3BA,EAgBuCC,KAAKC,SAAWN,EAdvDO,MAiBE,IAAK,UACH,GAAIP,EAfJK,MAAO,kBAAAL,EAAAK,KAAAG,QAAAR,EACC,MAAA,IAAK,OAAsB,GAAAA,EAAA,MAAA,kBAAAA,EAAAK,KAAAI,KAAAT,EAAA,MAAA,IAAA,UAD5B,GAAAA,EAETM,MAAU,kBAAAN,EAAAK,KAAAK,QAAAV,GAiJR,SAAAW,WAAcR,EAAUS,GACxB,IAAAC,KAeF,OAbGN,OAAAO,EAAA,SAAAC,EAAAC,GACF,GAAAD,EAAAE,QAAAC,EAlEW,OAmEZC,UAAAC,KAAAJ,GAnEYD,EAAAE,QAAAC,IAwEdG,QAAS,SAAAC,EAAAC,GAAiBC,EAAQN,MAAA,GAAAO,SAAAC,QAAAJ,EAAAJ,MA4D9BO,SAASL,KAAKE,EAAIJ,KA3DpBL,EAAIc,EAAQC,OAAKC,WAAjBf,EAAAQ,EAAAJ,OAEES,EAAMnB,EAANoB,OAAqBpB,KAGvBK,EAUD,SAxFaiB,YAAAhB,EAAAI,GAuJd,IAAIa,OAAAA,EA7DEC,EAAA9B,KAAAY,EAAA,SAAyBC,EAAAQ,GAAzB,OAAyBR,EAAAG,KAAAA,IAgE/B,GAAIc,GAAQA,EAAKf,OAAQ,CA/DvB,IAAIU,EAAAA,KAAQb,EAAKe,SAAjBd,EAAAQ,GAEAI,OADAA,EAAgBJ,EACVjB,EAAAA,KAAN0B,EAAiBf,SAEjBU,IACAM,UAAAb,MAAAc,MAAAH,EAAAI,QAAAC,IAhGYN,YAAAhB,EAAAkB,EAAAf,UAoGZ,SAAIU,IAAAA,GACJA,IAAAA,EAAMnB,MAAU6B,KAAhBC,QAAAd,GA+BEC,OA9BFE,EAAAA,QACAA,UAAMrB,SAAWkB,EAAKlB,EAALgB,GACjBV,EAAOe,GAAPY,KAAA3B,SAxGYa,YA4KVN,aAjEJqB,IAASN,EAAA/B,UAASsC,EAAgB,SAAA1B,GAAA,OAAAA,EAAAG,KAAAA,IAAAC,UAAAC,KAAAc,GAoE9B,IAAIQ,EAAS/B,WAAWC,MAAUM,GAnEpC,OAAKI,EAAOoB,EACRf,WAGJA,WAAA,SAAAf,EAAAM,GAhHJ,OAiHIS,EAAMjB,GAAN6B,KAAgBf,SAChBS,aACDH,YAAAlB,EAAAM,GAnHHe,WAuHId,cAAJ,SAAAwB,EAAAC,GACA,IAASjC,EAAT4B,KAAoBzB,SACdD,GAAAA,EAAJ,CAqEM,IAAMqB,EAAQ/B,UAAUS,EAAM+B,GAnEhCE,GACI5B,KAAAA,QAAN,UACEE,MAAUC,EACVR,KAASK,QAMTQ,EA+BH,SAAAqB,KAAAtB,GACF,IAAAuB,GAuEGC,OArEJpC,QACQqC,SAAQC,EACdD,OAAA,GACEE,OAAAA,GACEvC,UAAOA,GACPa,UAAW,GACXN,WAAY,IACkBiC,MAAA,GAAAC,YAA9B,EACAlC,SAAAA,IAGA,OADA4B,EAAA3C,MAAA2C,EAASvB,GACT8B,IAAOnC,GAGToC,SAAYC,KAAAhC,GACVZ,OAAAA,KAAOA,8UAlBVkC,aAiBaU,KAAAA,gBA3QZN,MAPFO,YAAAA,KACAxD,iBAAAA,UACAC,YAAAA,KACAC,iBAAAA,UACAC,aAAAA,MACAsD,eAAAA,QACAnD,cAAAA,OAGIF,MACFK,QAAUiD,MAAAC,cAAA,OAAKC,UAAU,aAAYF,MAAAC,cAAA,OAAKC,UAAU,qBAAf,WACrCvD,SAAUqD,MAAAC,cAAA,OAAKC,UAAU,aAAYF,MAAAC,cAAA,OAAKC,UAAU,kBAAf,SACrCrD,QAAUmD,MAAAC,cAAA,OAAKC,UAAU,aAAYF,MAAAC,cAAA,OAAKC,UAAU,iBAAf,eACrCpD,KAAUkD,MAAAC,cAAA,OAAKC,UAAU,aAAYF,MAAAC,cAAA,OAAKC,UAAU,kBAAf,aAFAxB,iBAAA,SAAAA,EAAAW,GAAAc,gBAAAvB,KAAAF,GAAA,IAAA0B,EAAAC,2BAAAzB,MAAAF,EAAA4B,WAAAC,OAAAC,eAAA9B,IAAA+B,KAAA7B,KAF5BS,IAE4B,OACrCxC,EAAAA,UAAUuD,EAAAM,UAAV7D,KAAAA,GAAUuD,EAAApC,OAAKf,KAAAmD,EAAUf,MAAApC,SAAYN,UAAA,EAAAE,SAAA,EAAAE,SAAK,EAALD,MAAA,GADAsD,0EAE3B,IAAKO,EAAU/B,KAAAS,MAAfsB,OAAA/B,KAAAS,MAAAsB,OAAA,GAA2BC,EAAAhC,KAAAS,MAAAuB,OAAAhC,KAAAS,MAAAuB,OAAA,GAAKC,EAAUf,MAAf7C,KAAAX,UAAAsC,KAAAZ,MAAAf,MAAA6D,UAAAlC,KAAAS,MAAAyB,UAA3BC,UAAAnC,KAAAS,MAAA0B,UAJdC,WAAApC,KAAAS,MAAA2B,aAQE,OACEL,GACEC,GACEhC,KAAAZ,MAAOjB,SACR6B,KAAAZ,MAAArB,UACDiC,KAAAZ,MAAAnB,SACF+B,KAAKZ,MAAAlB,KAGFkD,MAAAC,cAAA,OAAAC,UAAA,kBACD/D,eAAA,WAAAyC,KAAAZ,MAAArB,UACGgE,EACCtE,EACFuE,EACDzE,eAAA,UAAAyC,KAAAZ,MAAAjB,SACDZ,eAAA,OAAAyC,KAAAZ,MAAAlB,MACGX,eAAL,UAAAyC,KAAAZ,MAAAnB,UAIEgE,mCAqDF,OAAOjC,KAAK8B,mBA/EyBV,MAAAiB,WAmFnCtC,SApDcuC,OAAA,SAAApC,GAAA,IAAAjB,EAAAsD,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,MAsDZnD,EAAQY,KAAKV,SApDjBjB,EAAKyD,EAALzD,KAEEA,EAAWoC,EAALd,MACN5B,GAAAA,GAFW,GAED4B,EALI,CAUjBV,EAAAmB,MA0DG,IAAIsC,EAAUrE,EAAKsB,GAtDrB,OADA+C,EAAMX,MAASW,EAAWX,EAAX1D,MACT2D,EARJ/D,GAAAA,QAASgB,EAHEZ,MAKXH,OADAC,EAAAA,KAJWc,EAAAZ,KAKLe,GAUN8C,OAAAA,SAAWhC,GAAWgC,IAANzB,EAAMyB,UAAAA,OAAAA,QAAAA,IAAAA,UAAAA,GAAAA,UAAAA,MACtBC,EAAAA,KAAW7C,SACX8C,EAAAA,EAAY/D,KAcP0D,OA4CHZ,QAAQlC,EAAKZ,MAvDjBA,EACE0D,EAAAA,OACAC,EACA3D,MAMEA,EAAAQ,KAAAI,EAAAZ,MAEG0D,GAGAxE,QAAAA,SAAAA,GAA0B,IAAX0B,EAAWsD,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,MAC1BhF,EAAAA,KAAAA,SACAA,EAAAA,EAAAA,KA0DP,OA1EA4D,QAmBOlC,EAAAZ,MACLA,EAAAY,EAAOgD,KAAAA,OAAP5D,GAEHA,EAAAsE,QAAA1D,EAAAZ,MAoDQe,GA5CTkD,OAAQ,SAAApC,GAAyB,IAAhBA,EAAgBqC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,MAARtD,EAAQe,KAAAV,SAuD3BjB,EAAOe,EAAMf,KArDjB,GAAIA,EAAAA,MAwDFA,EAAKuE,OAAO3D,EAAKU,MAAO,QArDrBA,GAAAA,EAADS,MAAUT,CACZ,IAAKwB,EAAQlC,UAAaZ,EAAAY,EAAAmB,OACxBhB,GAAMf,GACNA,EAAAuE,OAAAjD,EAAA,GAGF,OAAIV,GAOLH,QAAA,SAAAoB,GAAA,IAAAjB,EAAAsD,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,MAnBWnD,EAAAY,KAAAV,SAuBZ,OAmDKF,EAAMlB,OApDb2E,EAAQ5E,QAAAgB,EAASiB,UAAgB,EAAAd,EAAArB,UAAA,GAC3BqB,GAGJ0D,OAAI3B,SAAQlC,GAAYsD,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GAAA,IACtBlE,EAAOA,KAAKgB,SAKd,OANAD,EAEOlB,OACLG,EAAKQ,SAAUR,EAChBe,EAAArB,UAAA,GAEMqB,GAGT2D,KAAAA,SAAS7C,GAASA,IAATjB,EAASiB,UAAAA,OAAAA,QAAAA,IAAAA,UAAAA,GAAAA,UAAAA,MAAQjB,EAAQe,KAAAV,SAIhC,OAqDAF,EAAMnB,SAAU,EAxDhBmB,EAAIA,UAAaE,EACjBF,EAAIf,SAAOe,EA0DXA,EAAMlB,KAAOe,EAAKf,OAAQ,EAxDtBiD,GAGF9C,SAAKsE,SAAQ1D,GAAb,IAAAA,EAAAsD,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,MACDnD,EAAAY,KAAAV,SA6DD,OAHAF,EAAMnB,SAAU,EAxDhBmB,EAAAlB,MAAA,EA7CYkB,EAAArB,SAAAkB,EAAAlB,WAAA,EAwGLqB,GAGTa,QAAS,SAASC,GAAgB,IAARjB,EAAQsD,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,MAChC,GAAKvC,MAAOA,KAAKZ,MAAjB,CACA,IAAIA,EAAQY,KAAKV,SAtDjB,OAuDAF,EAAMnB,SAAU,EAxDlB+E,EAAQjF,UAAA,EAAyBqB,EAARH,MAAQ,EA2D/BG,EAAMjB,QAAUc,EAAKd,UAAW,EA1D5BiB,KAIFf,YACDO,aAqBHkE,kBAAiCpD","file":"../index.js","sourcesContent":["\nconst {\n  list, \n  transTree,\n  find,\n  findIndex,\n  merge,\n  isArray,\n  filter\n} = Aotoo\n\nconst bars = {\n    trigger:  <div className=\"treex-bar\"><div className=\"treex-trigger-bar\">加载更多内容</div></div>\n  , pulldown: <div className=\"treex-bar\"><div className=\"treex-pull-bar\">刷新页面</div></div>\n  , loading:  <div className=\"treex-bar\"><div className=\"treex-loading\">Loading...</div></div>\n  , over:     <div className=\"treex-bar\"><div className=\"treex-over-bar\">没有更多内容了</div></div>\n}\n\nfunction getBehaviorBar(type, val){\n  switch (type) {\n    case 'pulldown':\n      if (val) {\n        return typeof val == 'boolean' ? bars.pulldown : val\n      }\n      break;\n    case 'loading':\n      if (val) {\n        return typeof val == 'boolean' ? bars.loading : val\n      }\n      break;\n    case 'over':\n      if (val) {\n        return typeof val == 'boolean' ? bars.over : val\n      }\n      break;\n    case 'trigger':\n      if (val) {\n        return typeof val == 'boolean' ? bars.trigger : val\n      }\n      break;\n  }\n}\n\nclass Tree extends React.Component {\n  constructor(props){\n    super(props)\n    this.preRender = this::this.preRender\n    this.state = {\n      data: this.props.data||[],\n      pulldown: false,\n      loading: false,\n      trigger: false,\n      over: false\n    }\n  }\n\n  preRender(){\n    const header = this.props.header ? this.props.header : ''\n    const footer = this.props.footer ? this.props.footer : ''\n\n    const list_part = list({\n      data: transTree(this.state.data),\n      listClass: this.props.listClass,\n      itemClass: this.props.itemClass,\n      itemMethod: this.props.itemMethod\n    })\n\n    if (\n      header ||\n      footer ||\n      this.state.trigger ||\n      this.state.pulldown ||\n      this.state.loading ||\n      this.state.over\n    ) {\n      return (\n        <div className=\"list-container\">\n          {getBehaviorBar('pulldown', this.state.pulldown)}\n          {header}\n          {list_part}\n          {footer}\n          {getBehaviorBar('trigger', this.state.trigger)}\n          {getBehaviorBar('over', this.state.over)}\n          {getBehaviorBar('loading', this.state.loading)}\n        </div>\n      )\n    } else {\n      return list_part\n    }\n  }\n\n  render(){\n    return this.preRender()\n  }\n}\n\nconst Actions = {\n  UPDATE: function(ostate, opts={}){\n    let state = this.curState\n    let data = state.data\n\n    const index = opts.index\n    if (!index && index!=0) {\n      if ( isArray(opts.data) ) {\n        state.data = opts.data\n        return state\n      }\n    } else {\n      if (opts.query) {\n\n      }\n\n      let oriData = data[index]\n      oriData = merge(oriData, opts.data)\n      return state\n    }\n  },\n\n  APPEND: function(ostate, opts={}){\n    let state = this.curState\n    let data = state.data\n\n    if (isArray(opts.data)) {\n      data = data.concat(opts.data)\n    } else {\n      data.push(opts.data)\n    }\n\n    return state\n  },\n\n  PREPEND: function(ostate, opts={}){\n    let state = this.curState\n    let data = state.data\n\n    if (isArray(opts.data)) {\n      data = opts.data.concat(data)\n    } else {\n      data.unshift(opts.data)\n    }\n\n    return state\n  },\n\n  /*\n    opts:{\n      index: {number}\n      query: {Json}\n    }\n  */\n  DELETE: function(ostate, opts={}){\n    let state = this.curState\n    let data = state.data\n\n    if (opts.index) {\n      data.splice(opts.index, 1);\n    }\n    else if(opts.query) {\n      const index = findIndex(data, opts.query)\n      if (index>-1) {\n        data.splice(index, 1)\n      }\n    }\n    return state\n  },\n\n  // ========== 状态控制 ===========\n\n  LOADING: function(ostate, opts={}){\n    let state = this.curState\n    if (!state.over) {\n      state.loading = opts.loading || true\n      state.pulldown = false\n    }\n    return state\n  },\n\n  LOADED: function(ostate, opts={}){\n    let state = this.curState\n    if (!state.over) {\n      state.loading = false\n      state.pulldown = false\n    }\n    return state\n  },\n\n  OVER: function(ostate, opts={}){\n    let state = this.curState\n    state.loading = false\n    state.pulldown = false\n    state.trigger = false\n    state.over = opts.over || true\n    return state\n  },\n\n  PULLDOWN: function(ostate, opts={}){\n    let state = this.curState\n    state.loading = false\n    state.over = false\n    state.pulldown = opts.pulldown || true\n    return state\n  },\n\n  TRIGGER: function(ostate, opts={}){\n    if (!this||!this.state) return\n    let state = this.curState\n    state.loading = false\n    state.pulldown = false\n    state.over = false\n    state.trigger = opts.trigger || true\n    return state\n  },\n}\n\nlet idrecode = []\nlet indexcode = []\nfunction _getGroups(dataAry, idf){\n  let nsons = []\n\n  let sons = filter(dataAry, (o, jj) => {\n    if (o.parent == idf) {\n      indexcode.push(jj)\n      return o.parent == idf\n    }\n  })\n\n  sons.forEach( (son, ii) => {\n    if (son.idf && idrecode.indexOf(son.idf) == -1) {\n      idrecode.push(son.idf)\n      nsons = nsons.concat(_getGroups(dataAry, son.idf))\n    } else {\n      nsons = nsons.concat(son)\n    }\n  })\n  return nsons\n}\n\nlet myParentsIndex = []\nlet myParents = []\n\n/**\n * [查找特定idf的数据，]\n * @param  {[type]} dataAry [description]\n * @param  {[type]} idf     [description]\n * @return {[type]}         [description]\n */\nfunction findParents(dataAry, idf){\n  let _parentIndex\n  const item = find(dataAry, (o,ii)=>o.idf==idf)\n\n  if (item && item.parent) {\n    const p = find(dataAry, (o, ii)=>{\n      _parentIndex = ii\n      return o.idf==item.parent\n    })\n    if (p){\n      myParents.push({index: _parentIndex, content: p})\n      findParents(dataAry, item.parent)\n    }\n  }\n}\n\nfunction App(opts){\n  const treeX = Aotoo(Tree, Actions, opts)\n  treeX.extend({\n    getGroups: function(data, idf, son){\n      data = data||this.data||[]\n      idrecode = []\n      indexcode = []\n      const index = findIndex(data, o=>o.idf==idf)\n      indexcode.push(index)\n      let groups = _getGroups(data||[], idf)\n      if (son) return groups\n      return indexcode\n    },\n\n    getParents: function(data, idf){\n      data = data||this.data||[]\n      myParents = []\n      findParents(data, idf)\n      return myParents\n    },\n\n    findAndUpdate: function(query, target){\n      const data = this.data||[]\n      if (query) {\n        const index = findIndex(data, query)\n        if (index) {\n          this.dispach('UPDATE', {\n            index: index,\n            data: target\n          })\n        }\n      }\n    }\n  })\n  return treeX\n}\n\n\n\n/*\n [ {title: '', idf: 'aaa', index: 0},\n  {title: 'abcfd', parent: 'aaa', index: 1},\n  {title: 'bcasd', parent: 'aaa', index: 2},\n  {title: 'aacwq', parent: 'aaa', index: 2},\n\n  {title: <button>123</button>, idf: 'bbb', index: 3},\n  {title: 'yyufs', parent: 'bbb', index: 4},\n  {title: 'xfdsw', parent: 'bbb', index: 5},\n  {title: 'xxxdsehh', parent: 'bbb', index: 5}, ]\n*/\n\n\n/*\n  props: {\n    data: {Array},\n    loading: {Boolean || JSX }\n    header: {JSX},\n    footer: {JSX},\n    itemClass: {String},\n    listClass: {String},\n    itemMethod: {Function}   componentDidMount 后列表项响应事件\n  }\n  theme: {String}  注入样式\n  autoinject: {Boolean} 是否自动注入\n  rendered: {Function} 渲染完成后的动作，在原生react 的 componentDidMount 后\n*/\n\nexport default function tree(opts){\n  let dft = {\n    props: {\n      data: [],\n      loading: false,\n      header: '',\n      footer: '',\n      itemClass: '',\n      listClass: '',\n      itemMethod: ''\n    },\n    theme: '',\n    autoinject: true,\n    rendered: ''\n  }\n  dft = merge(dft, opts)\n  return App(dft)\n}\n\nexport function pure(opts){\n  return tree(opts)\n}\n"]}